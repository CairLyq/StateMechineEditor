<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œä¸ºæ ‘æ¨¡æ¿æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .template-info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>è¡Œä¸ºæ ‘æ¨¡æ¿ç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æ¨¡æ¿åŠ è½½æµ‹è¯•</h2>
        <div id="templateLoadResults"></div>
    </div>
    
    <div class="test-section">
        <h2>æ¨¡æ¿å®ä¾‹åŒ–æµ‹è¯•</h2>
        <div id="instantiationResults"></div>
    </div>
    
    <div class="test-section">
        <h2>æ¨¡æ¿ä¿¡æ¯</h2>
        <div id="templateInfo"></div>
    </div>

    <!-- åŠ è½½æ‰€æœ‰å¿…éœ€çš„è„šæœ¬ -->
    <script src="nodes/BaseNode.js"></script>
    <script src="nodes/RootNode.js"></script>
    <script src="nodes/SelectorNode.js"></script>
    <script src="nodes/SequenceNode.js"></script>
    <script src="nodes/ParallelNode.js"></script>
    <script src="nodes/InverterNode.js"></script>
    <script src="nodes/RepeaterNode.js"></script>
    <script src="nodes/ActionNode.js"></script>
    <script src="nodes/ConditionNode.js"></script>
    <script src="nodes/NodeFactory.js"></script>
    <script src="nodes/index.js"></script>
    <script src="BehaviorTreeTemplates.js"></script>

    <script>
        function addResult(containerId, message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById(containerId).appendChild(div);
        }

        function addTemplateInfo(template) {
            const div = document.createElement('div');
            div.className = 'template-info';
            div.innerHTML = `
                <strong>${template.name}</strong><br>
                <em>åˆ†ç±»:</em> ${template.category}<br>
                <em>æè¿°:</em> ${template.description}<br>
                <em>èŠ‚ç‚¹æ•°:</em> ${template.nodes ? template.nodes.length : 0}
            `;
            document.getElementById('templateInfo').appendChild(div);
        }

        function runTests() {
            try {
                // æµ‹è¯•æ¨¡æ¿ç³»ç»ŸåŠ è½½
                const templates = new BehaviorTreeTemplates();
                addResult('templateLoadResults', 'âœ“ æ¨¡æ¿ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ', 'success');
                
                // è·å–æ‰€æœ‰æ¨¡æ¿
                const allTemplates = templates.getAllTemplates();
                addResult('templateLoadResults', `âœ“ åŠ è½½äº† ${allTemplates.length} ä¸ªæ¨¡æ¿`, 'success');
                
                // æ˜¾ç¤ºæ¨¡æ¿ä¿¡æ¯
                allTemplates.forEach(template => {
                    addTemplateInfo(template);
                });
                
                // æµ‹è¯•æ¯ä¸ªæ¨¡æ¿çš„å®ä¾‹åŒ–
                allTemplates.forEach(template => {
                    try {
                        const nodes = templates.instantiateTemplate(template.id);
                        if (nodes && nodes.length > 0) {
                            addResult('instantiationResults', `âœ“ æ¨¡æ¿ "${template.name}" å®ä¾‹åŒ–æˆåŠŸï¼Œåˆ›å»ºäº† ${nodes.length} ä¸ªèŠ‚ç‚¹`, 'success');
                            
                            // éªŒè¯æ ¹èŠ‚ç‚¹
                            const rootNode = nodes.find(node => node.type === NodeType.ROOT);
                            if (rootNode) {
                                addResult('instantiationResults', `âœ“ æ¨¡æ¿ "${template.name}" åŒ…å«æ ¹èŠ‚ç‚¹`, 'success');
                            } else {
                                addResult('instantiationResults', `âš  æ¨¡æ¿ "${template.name}" ç¼ºå°‘æ ¹èŠ‚ç‚¹`, 'error');
                            }
                            
                            // éªŒè¯èŠ‚ç‚¹å±æ€§
                            let hasProperties = false;
                            nodes.forEach(node => {
                                if (node.properties && Object.keys(node.properties).length > 0) {
                                    hasProperties = true;
                                }
                            });
                            
                            if (hasProperties) {
                                addResult('instantiationResults', `âœ“ æ¨¡æ¿ "${template.name}" èŠ‚ç‚¹åŒ…å«å±æ€§é…ç½®`, 'success');
                            }
                            
                        } else {
                            addResult('instantiationResults', `âŒ æ¨¡æ¿ "${template.name}" å®ä¾‹åŒ–å¤±è´¥`, 'error');
                        }
                    } catch (error) {
                        addResult('instantiationResults', `âŒ æ¨¡æ¿ "${template.name}" å®ä¾‹åŒ–é”™è¯¯: ${error.message}`, 'error');
                    }
                });
                
                // æµ‹è¯•æ¨¡æ¿æœç´¢
                const searchResults = templates.searchTemplates('AI');
                addResult('templateLoadResults', `âœ“ æœç´¢"AI"æ‰¾åˆ° ${searchResults.length} ä¸ªæ¨¡æ¿`, 'success');
                
                // æµ‹è¯•åˆ†ç±»ç­›é€‰
                const aiTemplates = templates.getTemplatesByCategory('AI');
                addResult('templateLoadResults', `âœ“ AIåˆ†ç±»åŒ…å« ${aiTemplates.length} ä¸ªæ¨¡æ¿`, 'success');
                
                addResult('templateLoadResults', 'ğŸ‰ æ‰€æœ‰æ¨¡æ¿æµ‹è¯•å®Œæˆï¼', 'success');
                
            } catch (error) {
                addResult('templateLoadResults', 'âŒ æ¨¡æ¿æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message, 'error');
                console.error('æ¨¡æ¿æµ‹è¯•é”™è¯¯:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(runTests, 200); // ç¨å¾®å»¶è¿Ÿç¡®ä¿æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆ
        });
    </script>
</body>
</html> 