<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ‚ç‚¹ç³»ç»Ÿé›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #canvas {
            border: 1px solid #ccc;
            background: #fff;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>è¡Œä¸ºæ ‘èŠ‚ç‚¹ç³»ç»Ÿé›†æˆæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. èŠ‚ç‚¹ç³»ç»ŸåŸºç¡€æµ‹è¯•</h2>
        <button onclick="testNodeSystem()">æµ‹è¯•èŠ‚ç‚¹ç³»ç»Ÿ</button>
        <div id="nodeSystemResults"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ç¼–è¾‘å™¨é›†æˆæµ‹è¯•</h2>
        <button onclick="testEditorIntegration()">æµ‹è¯•ç¼–è¾‘å™¨é›†æˆ</button>
        <canvas id="testCanvas" width="800" height="400"></canvas>
        <div id="editorResults"></div>
    </div>
    
    <div class="test-section">
        <h2>3. èŠ‚ç‚¹åˆ›å»ºæµ‹è¯•</h2>
        <button onclick="testNodeCreation()">æµ‹è¯•èŠ‚ç‚¹åˆ›å»º</button>
        <div id="nodeCreationResults"></div>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰å¿…è¦çš„è„šæœ¬ -->
    <script src="nodes/BaseNode.js"></script>
    <script src="nodes/SelectorNode.js"></script>
    <script src="nodes/SequenceNode.js"></script>
    <script src="nodes/ParallelNode.js"></script>
    <script src="nodes/InverterNode.js"></script>
    <script src="nodes/RepeaterNode.js"></script>
    <script src="nodes/ActionNode.js"></script>
    <script src="nodes/ConditionNode.js"></script>
    <script src="nodes/NodeFactory.js"></script>
    <script src="nodes/index.js"></script>
    <script src="BehaviorTreeRenderer.js"></script>
    <script src="BehaviorTreeSimulator.js"></script>
    <script src="BehaviorTreeTemplates.js"></script>
    <script src="BehaviorTreeEditor.js"></script>

    <script>
        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function testNodeSystem() {
            clearResults('nodeSystemResults');
            
            try {
                // æµ‹è¯•NodeFactory
                const factory = new NodeFactory();
                addResult('nodeSystemResults', 'âœ“ NodeFactory åˆ›å»ºæˆåŠŸ', 'success');
                
                // æµ‹è¯•èŠ‚ç‚¹åˆ›å»º
                const selectorNode = factory.createNode(NodeType.SELECTOR);
                addResult('nodeSystemResults', `âœ“ åˆ›å»ºé€‰æ‹©å™¨èŠ‚ç‚¹: ${selectorNode.name}`, 'success');
                
                const actionNode = factory.createNode(NodeType.ACTION);
                addResult('nodeSystemResults', `âœ“ åˆ›å»ºåŠ¨ä½œèŠ‚ç‚¹: ${actionNode.name}`, 'success');
                
                // æµ‹è¯•èŠ‚ç‚¹è¿æ¥
                selectorNode.addChild(actionNode);
                addResult('nodeSystemResults', `âœ“ èŠ‚ç‚¹è¿æ¥æˆåŠŸï¼Œå­èŠ‚ç‚¹æ•°é‡: ${selectorNode.children.length}`, 'success');
                
                // æµ‹è¯•èŠ‚ç‚¹åºåˆ—åŒ–
                const nodeData = factory.nodeToData(selectorNode);
                addResult('nodeSystemResults', 'âœ“ èŠ‚ç‚¹åºåˆ—åŒ–æˆåŠŸ', 'success');
                
                const restoredNode = factory.createNodeFromData(nodeData);
                addResult('nodeSystemResults', `âœ“ èŠ‚ç‚¹ååºåˆ—åŒ–æˆåŠŸ: ${restoredNode.name}`, 'success');
                
                addResult('nodeSystemResults', 'ğŸ‰ èŠ‚ç‚¹ç³»ç»Ÿæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼', 'success');
                
            } catch (error) {
                addResult('nodeSystemResults', `âŒ èŠ‚ç‚¹ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                console.error('èŠ‚ç‚¹ç³»ç»Ÿæµ‹è¯•é”™è¯¯:', error);
            }
        }

        function testEditorIntegration() {
            clearResults('editorResults');
            
            try {
                // åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹
                const editor = new BehaviorTreeEditor('testCanvas', {
                    gridSize: 20,
                    snapToGrid: false,
                    showGrid: false
                });
                
                addResult('editorResults', 'âœ“ ç¼–è¾‘å™¨åˆ›å»ºæˆåŠŸ', 'success');
                
                // æµ‹è¯•èŠ‚ç‚¹å·¥å‚æ˜¯å¦æ­£ç¡®é›†æˆ
                if (editor.nodeFactory) {
                    addResult('editorResults', 'âœ“ èŠ‚ç‚¹å·¥å‚é›†æˆæˆåŠŸ', 'success');
                } else {
                    addResult('editorResults', 'âŒ èŠ‚ç‚¹å·¥å‚é›†æˆå¤±è´¥', 'error');
                    return;
                }
                
                // æµ‹è¯•æ·»åŠ èŠ‚ç‚¹
                const node = editor.addNode(NodeType.SELECTOR, 100, 100);
                if (node && node.type === NodeType.SELECTOR) {
                    addResult('editorResults', `âœ“ æ·»åŠ èŠ‚ç‚¹æˆåŠŸ: ${node.name}`, 'success');
                } else {
                    addResult('editorResults', 'âŒ æ·»åŠ èŠ‚ç‚¹å¤±è´¥', 'error');
                    return;
                }
                
                // æµ‹è¯•èŠ‚ç‚¹æ•°é‡
                if (editor.tree.nodes.size > 0) {
                    addResult('editorResults', `âœ“ èŠ‚ç‚¹å·²æ·»åŠ åˆ°æ ‘ä¸­ï¼Œæ€»æ•°: ${editor.tree.nodes.size}`, 'success');
                } else {
                    addResult('editorResults', 'âŒ èŠ‚ç‚¹æœªæ·»åŠ åˆ°æ ‘ä¸­', 'error');
                }
                
                addResult('editorResults', 'ğŸ‰ ç¼–è¾‘å™¨é›†æˆæµ‹è¯•é€šè¿‡ï¼', 'success');
                
            } catch (error) {
                addResult('editorResults', `âŒ ç¼–è¾‘å™¨é›†æˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                console.error('ç¼–è¾‘å™¨é›†æˆæµ‹è¯•é”™è¯¯:', error);
            }
        }

        function testNodeCreation() {
            clearResults('nodeCreationResults');
            
            try {
                const factory = new NodeFactory();
                const nodeTypes = [NodeType.ROOT, NodeType.SELECTOR, NodeType.SEQUENCE, NodeType.PARALLEL, NodeType.INVERTER, NodeType.REPEATER, NodeType.ACTION, NodeType.CONDITION];
                
                nodeTypes.forEach(type => {
                    try {
                        const node = factory.createNode(type);
                        addResult('nodeCreationResults', `âœ“ ${type} èŠ‚ç‚¹åˆ›å»ºæˆåŠŸ: ${node.name}`, 'success');
                    } catch (error) {
                        addResult('nodeCreationResults', `âŒ ${type} èŠ‚ç‚¹åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                    }
                });
                
                addResult('nodeCreationResults', 'ğŸ‰ æ‰€æœ‰èŠ‚ç‚¹ç±»å‹åˆ›å»ºæµ‹è¯•å®Œæˆï¼', 'info');
                
            } catch (error) {
                addResult('nodeCreationResults', `âŒ èŠ‚ç‚¹åˆ›å»ºæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                console.error('èŠ‚ç‚¹åˆ›å»ºæµ‹è¯•é”™è¯¯:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åŸºç¡€æµ‹è¯•...');
            setTimeout(() => {
                testNodeSystem();
            }, 100);
        });
    </script>
</body>
</html> 